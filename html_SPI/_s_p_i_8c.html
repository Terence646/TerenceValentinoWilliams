<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TW_SPI_Project: /Users/terencewilliams/Desktop/CU Boulder/Fall 2021/Embedded Software Engineering/Lab 7/TW_SPI_Project/src/Source Files/SPI.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TW_SPI_Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_s_p_i_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">SPI.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>SPI Driver.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;SPI.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae0056a4ff3328d34e96eb23adb775e06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_8c.html#ae0056a4ff3328d34e96eb23adb775e06">spi_open</a> (USART_TypeDef *usart, SPI_OPEN_STRUCT *spi_settings)</td></tr>
<tr class="memdesc:ae0056a4ff3328d34e96eb23adb775e06"><td class="mdescLeft">&#160;</td><td class="mdescRight">spi_open is used to initialize the SPI Driver  <a href="_s_p_i_8c.html#ae0056a4ff3328d34e96eb23adb775e06">More...</a><br /></td></tr>
<tr class="separator:ae0056a4ff3328d34e96eb23adb775e06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae958986c6ea1d661c6ea170a0f4bb384"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_8c.html#ae958986c6ea1d661c6ea170a0f4bb384">spi_start</a> (USART_TypeDef *usart, bool readTrue, uint32_t bytes, uint32_t registerAddress, uint32_t callback, uint32_t *storeData, uint32_t write_data)</td></tr>
<tr class="memdesc:ae958986c6ea1d661c6ea170a0f4bb384"><td class="mdescLeft">&#160;</td><td class="mdescRight">spi_start is used to start the SPI Driver  <a href="_s_p_i_8c.html#ae958986c6ea1d661c6ea170a0f4bb384">More...</a><br /></td></tr>
<tr class="separator:ae958986c6ea1d661c6ea170a0f4bb384"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a0229960493cc5f95f2fb9f85d02286"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_8c.html#a1a0229960493cc5f95f2fb9f85d02286">USART3_RX_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a1a0229960493cc5f95f2fb9f85d02286"><td class="mdescLeft">&#160;</td><td class="mdescRight">USART3_RX_IRQHandler handles the RX interrupts generated on the USART peripherial.  <a href="_s_p_i_8c.html#a1a0229960493cc5f95f2fb9f85d02286">More...</a><br /></td></tr>
<tr class="separator:a1a0229960493cc5f95f2fb9f85d02286"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cfde02710dc38ff06d2958255874cf4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_8c.html#a9cfde02710dc38ff06d2958255874cf4">usart_rxdatav_sm</a> (SPI_STATE_MACHINE *spi_sm)</td></tr>
<tr class="memdesc:a9cfde02710dc38ff06d2958255874cf4"><td class="mdescLeft">&#160;</td><td class="mdescRight">usart_rxdatav_sm handles the state changes whenever an RXdata IF is generated  <a href="_s_p_i_8c.html#a9cfde02710dc38ff06d2958255874cf4">More...</a><br /></td></tr>
<tr class="separator:a9cfde02710dc38ff06d2958255874cf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af76537883229fb4d221146b2315bdb4d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_8c.html#af76537883229fb4d221146b2315bdb4d">USART3_TX_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:af76537883229fb4d221146b2315bdb4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">USART3_TX_IRQHandler is used to Service the interrupt flags generated on the usart TX peripherial.  <a href="_s_p_i_8c.html#af76537883229fb4d221146b2315bdb4d">More...</a><br /></td></tr>
<tr class="separator:af76537883229fb4d221146b2315bdb4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab809341d780a5908dda2626d9e9dd76c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_8c.html#ab809341d780a5908dda2626d9e9dd76c">usart_txbl_sm</a> (SPI_STATE_MACHINE *spi_sm)</td></tr>
<tr class="memdesc:ab809341d780a5908dda2626d9e9dd76c"><td class="mdescLeft">&#160;</td><td class="mdescRight">usart_txbl_sm is used to handle the state changes everytime a txbl interrupt is generated on the usart3 peripherial  <a href="_s_p_i_8c.html#ab809341d780a5908dda2626d9e9dd76c">More...</a><br /></td></tr>
<tr class="separator:ab809341d780a5908dda2626d9e9dd76c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97ddb63f25dc185020194a1181ceade4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_8c.html#a97ddb63f25dc185020194a1181ceade4">usart_txc_sm</a> (SPI_STATE_MACHINE *spi_sm)</td></tr>
<tr class="memdesc:a97ddb63f25dc185020194a1181ceade4"><td class="mdescLeft">&#160;</td><td class="mdescRight">usart_txc_sm is used handle the TXC interrupt flags generated on the usart3 peripherial  <a href="_s_p_i_8c.html#a97ddb63f25dc185020194a1181ceade4">More...</a><br /></td></tr>
<tr class="separator:a97ddb63f25dc185020194a1181ceade4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >SPI Driver. </p>
<dl class="section author"><dt>Author</dt><dd>Terence Williams </dd></dl>
<dl class="section date"><dt>Date</dt><dd>9/30/21 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ae0056a4ff3328d34e96eb23adb775e06" name="ae0056a4ff3328d34e96eb23adb775e06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0056a4ff3328d34e96eb23adb775e06">&#9670;&nbsp;</a></span>spi_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_open </td>
          <td>(</td>
          <td class="paramtype">USART_TypeDef *&#160;</td>
          <td class="paramname"><em>usart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SPI_OPEN_STRUCT *&#160;</td>
          <td class="paramname"><em>spi_settings</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>spi_open is used to initialize the SPI Driver </p>
<p >spi_open initialize the local usart structure, enables the usart3 clock, and routes to the correct usart RX and TX port/pins. In addition to all of this, at the very end of the function the NVIC is enabled for interrupts on the RX and TX data lines. </p><dl class="section note"><dt>Note</dt><dd>spi_open is called at the end of the sensor open function. This can change depending on the application.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">usart</td><td>usart is the usart peripherial defined for the application purpose.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spi_settings</td><td>spi_settings is the structure containing the specifc settings in order to set up the peripherial correctly </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae958986c6ea1d661c6ea170a0f4bb384" name="ae958986c6ea1d661c6ea170a0f4bb384"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae958986c6ea1d661c6ea170a0f4bb384">&#9670;&nbsp;</a></span>spi_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_start </td>
          <td>(</td>
          <td class="paramtype">USART_TypeDef *&#160;</td>
          <td class="paramname"><em>usart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>readTrue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>registerAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>storeData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>write_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>spi_start is used to start the SPI Driver </p>
<p >spi_start initializes the local usart_state structure that will be used by the SPI state machine. This incldues but not limited to initializing the data to be written, the register address, and the specifc callback function that will later be added to the scheduler.</p>
<dl class="section note"><dt>Note</dt><dd>spi_start is called in the ICM read and write functions respectively</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">usart</td><td>usart is the usart peripherial defined for the application purpose.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">readTrue</td><td>readTrue is a boolean variable to define wether the spi_start fucntion will be a read or a write</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bytes</td><td>bytes is a uint32_t variable defining how many bytes will be read or written</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">registerAddress</td><td>registerAddress is the register that will be read from or written to</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">callback</td><td>callback is the defined callback that will be added to the scheduler</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">storeData</td><td>storeData the Data that will be read, only utilized in a read function. For a SPI start write operation, 0 will be passed in for this parameter.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">write_data</td><td>write_data is the Data that will be written, only utilized in a write function. For a SPI start read operation, 0 will be passed in for this parameter. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1a0229960493cc5f95f2fb9f85d02286" name="a1a0229960493cc5f95f2fb9f85d02286"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a0229960493cc5f95f2fb9f85d02286">&#9670;&nbsp;</a></span>USART3_RX_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USART3_RX_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>USART3_RX_IRQHandler handles the RX interrupts generated on the USART peripherial. </p>
<p >The USART3_RX_IRQHandler checks for the RXDataV interrupt then calls the RXdatav State machine, passing in the usart state structure that was initialized in the SPI start function.</p>
<dl class="section note"><dt>Note</dt><dd>The only interrupts that should be generated are the RXdataV. This interrupt signifies that there is data in the RX buffer.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af76537883229fb4d221146b2315bdb4d" name="af76537883229fb4d221146b2315bdb4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af76537883229fb4d221146b2315bdb4d">&#9670;&nbsp;</a></span>USART3_TX_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USART3_TX_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>USART3_TX_IRQHandler is used to Service the interrupt flags generated on the usart TX peripherial. </p>
<p >USART3_TX_IRQHandler handles both the TXBL interrupt as well as the TXC interrupt by utilizing a function call to the usart txbl and txc state machines.</p>
<dl class="section note"><dt>Note</dt><dd>N/A </dd></dl>

</div>
</div>
<a id="a9cfde02710dc38ff06d2958255874cf4" name="a9cfde02710dc38ff06d2958255874cf4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cfde02710dc38ff06d2958255874cf4">&#9670;&nbsp;</a></span>usart_rxdatav_sm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usart_rxdatav_sm </td>
          <td>(</td>
          <td class="paramtype">SPI_STATE_MACHINE *&#160;</td>
          <td class="paramname"><em>spi_sm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>usart_rxdatav_sm handles the state changes whenever an RXdata IF is generated </p>
<p >usart_rxdatav_sm will only be called in either a write data or read data state.</p>
<dl class="section note"><dt>Note</dt><dd>If the state machine is in the sendRa state when an RXdataV IF is generated, an EFM assert will fail</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">spi_sm</td><td>spi_sm is the state machine for the SPI peripherial which will be used in order to handle the SPI driver process. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab809341d780a5908dda2626d9e9dd76c" name="ab809341d780a5908dda2626d9e9dd76c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab809341d780a5908dda2626d9e9dd76c">&#9670;&nbsp;</a></span>usart_txbl_sm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usart_txbl_sm </td>
          <td>(</td>
          <td class="paramtype">SPI_STATE_MACHINE *&#160;</td>
          <td class="paramname"><em>spi_sm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>usart_txbl_sm is used to handle the state changes everytime a txbl interrupt is generated on the usart3 peripherial </p>
<p >usart_txbl_sm sends the Register address,as well as handles the reading in of Data and the writing of data, depending on which state the state machine is in.</p>
<dl class="section note"><dt>Note</dt><dd>The Write and Read counters are initialized at the same time and to the same value in the SPI start function. However, they are independent of each other. </dd></dl>

</div>
</div>
<a id="a97ddb63f25dc185020194a1181ceade4" name="a97ddb63f25dc185020194a1181ceade4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97ddb63f25dc185020194a1181ceade4">&#9670;&nbsp;</a></span>usart_txc_sm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usart_txc_sm </td>
          <td>(</td>
          <td class="paramtype">SPI_STATE_MACHINE *&#160;</td>
          <td class="paramname"><em>spi_sm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>usart_txc_sm is used handle the TXC interrupt flags generated on the usart3 peripherial </p>
<p >When a TXC IF is set, this function will handle the closing processes of the SPI transmission. This includes unblocking the sleep mode (EM2), setting the busy bit to false, and adding the callback the the scheduler.</p>
<dl class="section note"><dt>Note</dt><dd>This function will fail an EFM assert if in any other state besides write data. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_10a9f7646d31d89b3136ccc7ed7fe557.html">TW_SPI_Project</a></li><li class="navelem"><a class="el" href="dir_924a5f5815417c6ed9cdd457e3007a5a.html">src</a></li><li class="navelem"><a class="el" href="dir_531eaca9c0032f25ac5a4eb1d1385ecd.html">Source Files</a></li><li class="navelem"><a class="el" href="_s_p_i_8c.html">SPI.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
